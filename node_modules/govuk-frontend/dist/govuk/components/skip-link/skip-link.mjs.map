{"version":3,"file":"skip-link.mjs","sources":["../../../../src/govuk/components/skip-link/skip-link.mjs"],"sourcesContent":["import { getFragmentFromUrl } from '../../common/index.mjs'\nimport { ElementError } from '../../errors/index.mjs'\nimport { GOVUKFrontendComponent } from '../../govuk-frontend-component.mjs'\n\n/**\n * Skip link component\n *\n * @preserve\n */\nexport class SkipLink extends GOVUKFrontendComponent {\n  /** @private */\n  $module\n\n  /** @private */\n  $linkedElement\n\n  /** @private */\n  linkedElementListener = false\n\n  /**\n   * @param {Element | null} $module - HTML element to use for skip link\n   * @throws {ElementError} when $module is not set or the wrong type\n   * @throws {ElementError} when $module.hash does not contain a hash\n   * @throws {ElementError} when the linked element is missing or the wrong type\n   */\n  constructor($module) {\n    super()\n\n    if (!($module instanceof HTMLAnchorElement)) {\n      throw new ElementError({\n        componentName: 'Skip link',\n        element: $module,\n        expectedType: 'HTMLAnchorElement',\n        identifier: 'Root element (`$module`)'\n      })\n    }\n\n    this.$module = $module\n\n    const hash = this.$module.hash\n    const href = this.$module.getAttribute('href') ?? ''\n\n    /** @type {URL | undefined} */\n    let url\n\n    /**\n     * Check for valid link URL\n     *\n     * {@link https://caniuse.com/url}\n     * {@link https://url.spec.whatwg.org}\n     *\n     */\n    try {\n      url = new window.URL(this.$module.href)\n    } catch (error) {\n      throw new ElementError(\n        `Skip link: Target link (\\`href=\"${href}\"\\`) is invalid`\n      )\n    }\n\n    // Return early for external URLs or links to other pages\n    if (\n      url.origin !== window.location.origin ||\n      url.pathname !== window.location.pathname\n    ) {\n      return\n    }\n\n    const linkedElementId = getFragmentFromUrl(hash)\n\n    // Check link path matching current page\n    if (!linkedElementId) {\n      throw new ElementError(\n        `Skip link: Target link (\\`href=\"${href}\"\\`) has no hash fragment`\n      )\n    }\n\n    const $linkedElement = document.getElementById(linkedElementId)\n\n    // Check for link target element\n    if (!$linkedElement) {\n      throw new ElementError({\n        componentName: 'Skip link',\n        element: $linkedElement,\n        identifier: `Target content (\\`id=\"${linkedElementId}\"\\`)`\n      })\n    }\n\n    this.$linkedElement = $linkedElement\n\n    this.$module.addEventListener('click', () => this.focusLinkedElement())\n  }\n\n  /**\n   * Focus the linked element\n   *\n   * Set tabindex and helper CSS class. Set listener to remove them on blur.\n   *\n   * @private\n   */\n  focusLinkedElement() {\n    if (!this.$linkedElement) {\n      return\n    }\n\n    if (!this.$linkedElement.getAttribute('tabindex')) {\n      // Set the element tabindex to -1 so it can be focused with JavaScript.\n      this.$linkedElement.setAttribute('tabindex', '-1')\n      this.$linkedElement.classList.add('govuk-skip-link-focused-element')\n\n      // Add listener for blur on the focused element (unless the listener has\n      // previously been added)\n      if (!this.linkedElementListener) {\n        this.$linkedElement.addEventListener('blur', () =>\n          this.removeFocusProperties()\n        )\n        this.linkedElementListener = true\n      }\n    }\n\n    this.$linkedElement.focus()\n  }\n\n  /**\n   * Remove the tabindex that makes the linked element focusable because the\n   * element only needs to be focusable until it has received programmatic focus\n   * and a screen reader has announced it.\n   *\n   * Remove the CSS class that removes the native focus styles.\n   *\n   * @private\n   */\n  removeFocusProperties() {\n    if (!this.$linkedElement) {\n      return\n    }\n\n    this.$linkedElement.removeAttribute('tabindex')\n    this.$linkedElement.classList.remove('govuk-skip-link-focused-element')\n  }\n\n  /**\n   * Name for the component used when initialising using data-module attributes.\n   */\n  static moduleName = 'govuk-skip-link'\n}\n"],"names":["SkipLink","GOVUKFrontendComponent","constructor","$module","_this$$module$getAttr","$linkedElement","linkedElementListener","HTMLAnchorElement","ElementError","componentName","element","expectedType","identifier","hash","href","getAttribute","url","window","URL","error","origin","location","pathname","linkedElementId","getFragmentFromUrl","document","getElementById","addEventListener","focusLinkedElement","setAttribute","classList","add","removeFocusProperties","focus","removeAttribute","remove","moduleName"],"mappings":"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"}