{% extends "layouts/beta-header.html" %}

{% block pageTitle %}
  Select land and actions
{% endblock %}

{% block beforeContent %}
  {% include "_common/sub-header-beta.html" %}

  {{ govukBackLink({
    text: "Back",
    href: "javascript:window.history.back()"
  }) }}
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-l">Choose actions for parcel 'Lower Field'</h1>
    <p class="govuk-body">The list of compatible actions, based on your land data, is below.</p>
    <br>

    <!-- Three column layout -->
    <div class="govuk-grid-row">
      
      <!-- Left column - Parcel info (1/4) -->
      <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-m" id="parcel-name">Lower Field</h2>
        <div class="govuk-!-margin-bottom-6">
          <table class="govuk-table">
            <tbody class="govuk-table__body" id="parcel-info">
              <tr class="govuk-table__row">
                <td class="govuk-table__cell">OS Map Sheet Reference</td>
                <td class="govuk-table__cell" id="os-ref">S03</td>
              </tr>
              <tr class="govuk-table__row">
                <td class="govuk-table__cell">Number of available land parcels</td>
                <td class="govuk-table__cell" id="num-parcels">20</td>
              </tr>
              <tr class="govuk-table__row">
                <td class="govuk-table__cell">Total area (ha)</td>
                <td class="govuk-table__cell" id="total-area">120.3451</td>
              </tr>
              <tr class="govuk-table__row">
                <td class="govuk-table__cell">Number of land parcels used for actions</td>
                <td class="govuk-table__cell" id="parcels-used">0</td>
              </tr>
              <tr class="govuk-table__row">
                <td class="govuk-table__cell">Number of actions applied for</td>
                <td class="govuk-table__cell" id="actions-applied">0</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Center column - Map (1/2) -->
      <div class="govuk-grid-column-one-half">
        <div style="border: 2px solid #b1b4b6; min-height: 400px; position: relative; overflow: hidden;">
          <!-- Satellite imagery background with image map -->
          <img src="/public/images/design-history-v2_1/satellite-map.jpg" alt="Satellite view of farm fields" usemap="#fieldmap" style="width: 100%; height: 400px; object-fit: cover; display: block;">
          
          <map name="fieldmap">
            <area shape="rect" coords="230,112,350,200" href="#" onclick="selectParcel('lower-field'); return false;" alt="Lower Field">
            <area shape="rect" coords="50,60,180,160" href="#" onclick="selectParcel('upper-field'); return false;" alt="Upper Field">
            <area shape="rect" coords="360,40,480,120" href="#" onclick="selectParcel('woods-view'); return false;" alt="Woods View">
            <area shape="rect" coords="30,240,200,340" href="#" onclick="selectParcel('long-meadow'); return false;" alt="Long Meadow">
            <area shape="rect" coords="250,280,420,380" href="#" onclick="selectParcel('river-pasture'); return false;" alt="River Pasture">
          </map>
          
          <!-- Selected field overlay - visual indicator -->
          <svg id="field-highlight" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
            <rect id="highlight-inner" x="230" y="112" width="120" height="88" fill="rgba(255, 221, 0, 0.1)" stroke="#00703c" stroke-width="3" />
            <rect id="highlight-outer" x="227" y="109" width="126" height="94" fill="none" stroke="#ffdd00" stroke-width="3" />
          </svg>
          
          <p class="govuk-body-s" style="position: absolute; bottom: 10px; right: 10px; margin: 0; background: white; padding: 5px; border: 1px solid #b1b4b6;">Â© Crown copyright</p>
        </div>
      </div>

    </div>

    <!-- Bottom section - Available actions -->
    <div class="govuk-grid-row govuk-!-margin-top-6">
      
      <!-- Other parcels column (1/2) -->
      <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-m">Other parcels</h2>
        <table class="govuk-table">
          <tbody class="govuk-table__body">
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('upper-field'); return false;" class="govuk-link">Upper field</a></td>
              <td class="govuk-table__cell">Total area: 5.2341 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('woods-view'); return false;" class="govuk-link">Woods view</a></td>
              <td class="govuk-table__cell">Total area: 12.8765 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('long-meadow'); return false;" class="govuk-link">Long meadow</a></td>
              <td class="govuk-table__cell">Total area: 8.4521 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('river-pasture'); return false;" class="govuk-link">River pasture</a></td>
              <td class="govuk-table__cell">Total area: 15.3267 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('top-barn-field'); return false;" class="govuk-link">Top barn field</a></td>
              <td class="govuk-table__cell">Total area: 6.7894 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('lower-paddock'); return false;" class="govuk-link">Lower paddock</a></td>
              <td class="govuk-table__cell">Total area: 3.9152 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('oak-tree-field'); return false;" class="govuk-link">Oak tree field</a></td>
              <td class="govuk-table__cell">Total area: 11.2483 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('south-slope'); return false;" class="govuk-link">South slope</a></td>
              <td class="govuk-table__cell">Total area: 9.6721 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('mill-field'); return false;" class="govuk-link">Mill field</a></td>
              <td class="govuk-table__cell">Total area: 7.1358 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('far-corner'); return false;" class="govuk-link">Far corner</a></td>
              <td class="govuk-table__cell">Total area: 4.5692 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('home-meadow'); return false;" class="govuk-link">Home meadow</a></td>
              <td class="govuk-table__cell">Total area: 13.8214 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('church-field'); return false;" class="govuk-link">Church field</a></td>
              <td class="govuk-table__cell">Total area: 6.3547 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('brook-side'); return false;" class="govuk-link">Brook side</a></td>
              <td class="govuk-table__cell">Total area: 10.7265 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('hill-top'); return false;" class="govuk-link">Hill top</a></td>
              <td class="govuk-table__cell">Total area: 8.9431 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('spring-field'); return false;" class="govuk-link">Spring field</a></td>
              <td class="govuk-table__cell">Total area: 5.6789 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('gate-field'); return false;" class="govuk-link">Gate field</a></td>
              <td class="govuk-table__cell">Total area: 14.2156 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('stone-wall-pasture'); return false;" class="govuk-link">Stone wall pasture</a></td>
              <td class="govuk-table__cell">Total area: 7.8923 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('orchard-field'); return false;" class="govuk-link">Orchard field</a></td>
              <td class="govuk-table__cell">Total area: 3.4671 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('back-field'); return false;" class="govuk-link">Back field</a></td>
              <td class="govuk-table__cell">Total area: 11.5284 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('pond-field'); return false;" class="govuk-link">Pond field</a></td>
              <td class="govuk-table__cell">Total area: 9.1647 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('north-meadow'); return false;" class="govuk-link">North meadow</a></td>
              <td class="govuk-table__cell">Total area: 6.8935 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('willow-field'); return false;" class="govuk-link">Willow field</a></td>
              <td class="govuk-table__cell">Total area: 12.3458 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('high-pasture'); return false;" class="govuk-link">High pasture</a></td>
              <td class="govuk-table__cell">Total area: 4.7821 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('lane-field'); return false;" class="govuk-link">Lane field</a></td>
              <td class="govuk-table__cell">Total area: 8.2594 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('big-meadow'); return false;" class="govuk-link">Big meadow</a></td>
              <td class="govuk-table__cell">Total area: 16.4372 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('little-field'); return false;" class="govuk-link">Little field</a></td>
              <td class="govuk-table__cell">Total area: 2.8156 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('bottom-field'); return false;" class="govuk-link">Bottom field</a></td>
              <td class="govuk-table__cell">Total area: 10.9283 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('valley-field'); return false;" class="govuk-link">Valley field</a></td>
              <td class="govuk-table__cell">Total area: 7.5641 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('boundary-field'); return false;" class="govuk-link">Boundary field</a></td>
              <td class="govuk-table__cell">Total area: 5.1928 ha</td>
            </tr>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell"><a href="#" onclick="selectParcel('cottage-field'); return false;" class="govuk-link">Cottage field</a></td>
              <td class="govuk-table__cell">Total area: 13.6475 ha</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Available actions column (3/4) -->
      <div class="govuk-grid-column-one-half">
        <h2 class="govuk-heading-m" id="actions-heading">Available actions on Lower Field</h2>
        <p>You can search for an action or select from the list.</p>
        
        <!-- Search box -->
        <div class="govuk-form-group">
          <label class="govuk-label" for="search-actions-map">
            Search by name or code
          </label>
          <div style="display: flex; gap: 0;">
            <input class="govuk-input" style="width:300px; height:44px;" id="search-actions-map" name="search" type="search" placeholder="Start typing to search...">
            <button type="button" id="search-button-map" class="govuk-button" style="height: 44px; margin-bottom: 0; background-color: #1d70b8;" data-module="govuk-button">
              <svg style="display: block; margin-left:0px" class="gem-c-search__icon" width="21" height="21" viewBox="0 0 28 32" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                <circle cx="12.0161" cy="11.0161" r="8.51613" stroke="currentColor" stroke-width="3"></circle>
                <line x1="17.8668" y1="17.3587" x2="26.4475" y2="25.9393" stroke="currentColor" stroke-width="3"></line>
              </svg>
            </button>
          </div>
        </div>

        <!-- Action selection list -->
        <div class="govuk-form-group">
          <fieldset class="govuk-fieldset">
            <div class="govuk-checkboxes" data-module="govuk-checkboxes">
              
              <!-- CNUM3 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-cnum3" name="actions" type="checkbox" value="CNUM3">
                <label class="govuk-label govuk-checkboxes__label" for="action-cnum3">
                  <strong>CNUM3</strong> - Legume fallow
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£593 per ha</span>
                </label>
              </li>

              <!-- CAHL1 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-cahl1" name="actions" type="checkbox" value="CAHL1">
                <label class="govuk-label govuk-checkboxes__label" for="action-cahl1">
                  <strong>CAHL1</strong> - Pollen and nectar flower mix
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£739 per ha</span>
                </label>
              </li>

              <!-- CAHL2 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-cahl2" name="actions" type="checkbox" value="CAHL2">
                <label class="govuk-label govuk-checkboxes__label" for="action-cahl2">
                  <strong>CAHL2</strong> - Winter bird food on arable and horticultural land
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£853 per ha</span>
                </label>
              </li>

              <!-- CHRW2 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-chrw2" name="actions" type="checkbox" value="CHRW2">
                <label class="govuk-label govuk-checkboxes__label" for="action-chrw2">
                  <strong>CHRW2</strong> - Manage hedgerows
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£13 per 100m</span>
                </label>
              </li>

              <!-- CSAM2 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-csam2" name="actions" type="checkbox" value="CSAM2">
                <label class="govuk-label govuk-checkboxes__label" for="action-csam2">
                  <strong>CSAM2</strong> - Multi-species winter cover crop
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£129 per ha</span>
                </label>
              </li>

              <!-- BFS1 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-bfs1" name="actions" type="checkbox" value="BFS1">
                <label class="govuk-label govuk-checkboxes__label" for="action-bfs1">
                  <strong>BFS1</strong> - 12m to 24m watercourse buffer strip on cultivated land
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£707 per ha</span>
                </label>
              </li>

              <!-- AHW7 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-ahw7" name="actions" type="checkbox" value="AHW7">
                <label class="govuk-label govuk-checkboxes__label" for="action-ahw7">
                  <strong>AHW7</strong> - Enhanced overwinter stubble
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£589 per ha</span>
                </label>
              </li>

              <!-- CIPM2 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-cipm2" name="actions" type="checkbox" value="CIPM2">
                <label class="govuk-label govuk-checkboxes__label" for="action-cipm2">
                  <strong>CIPM2</strong> - Flower-rich grass margins
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£798 per ha</span>
                </label>
              </li>

              <!-- WBD1 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-wbd1" name="actions" type="checkbox" value="WBD1">
                <label class="govuk-label govuk-checkboxes__label" for="action-wbd1">
                  <strong>WBD1</strong> - Manage ponds
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£257 per pond</span>
                </label>
              </li>

              <!-- CNUM2 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-cnum2" name="actions" type="checkbox" value="CNUM2">
                <label class="govuk-label govuk-checkboxes__label" for="action-cnum2">
                  <strong>CNUM2</strong> - Legumes on improved grassland
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£102 per ha</span>
                </label>
              </li>

              <!-- SOH1 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-soh1" name="actions" type="checkbox" value="SOH1">
                <label class="govuk-label govuk-checkboxes__label" for="action-soh1">
                  <strong>SOH1</strong> - No-till farming
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£73 per ha</span>
                </label>
              </li>

              <!-- CIGL1 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-cigl1" name="actions" type="checkbox" value="CIGL1">
                <label class="govuk-label govuk-checkboxes__label" for="action-cigl1">
                  <strong>CIGL1</strong> - Take grassland field corners or blocks out of management
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£333 per ha</span>
                </label>
              </li>

              <!-- BND1 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-bnd1" name="actions" type="checkbox" value="BND1">
                <label class="govuk-label govuk-checkboxes__label" for="action-bnd1">
                  <strong>BND1</strong> - Maintain dry stone walls
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£27 per 100m</span>
                </label>
              </li>

              <!-- AHW3 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-ahw3" name="actions" type="checkbox" value="AHW3">
                <label class="govuk-label govuk-checkboxes__label" for="action-ahw3">
                  <strong>AHW3</strong> - Beetle banks
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£764 per ha</span>
                </label>
              </li>

              <!-- CSAM3 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-csam3" name="actions" type="checkbox" value="CSAM3">
                <label class="govuk-label govuk-checkboxes__label" for="action-csam3">
                  <strong>CSAM3</strong> - Herbal leys
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£382 per ha</span>
                </label>
              </li>

              <!-- PRF1 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-prf1" name="actions" type="checkbox" value="PRF1">
                <label class="govuk-label govuk-checkboxes__label" for="action-prf1">
                  <strong>PRF1</strong> - Variable rate application of nutrients
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£27 per ha</span>
                </label>
              </li>

              {# <!-- CHRW3 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-chrw3" name="actions" type="checkbox" value="CHRW3">
                <label class="govuk-label govuk-checkboxes__label" for="action-chrw3">
                  <strong>CHRW3</strong> - Maintain or establish hedgerow trees
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£10 per 100m</span>
                </label>
              </li>

              <!-- WBD3 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-wbd3" name="actions" type="checkbox" value="WBD3">
                <label class="govuk-label govuk-checkboxes__label" for="action-wbd3">
                  <strong>WBD3</strong> - In-field grass strips
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£765 per ha</span>
                </label>
              </li>

              <!-- AHW5 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-ahw5" name="actions" type="checkbox" value="AHW5">
                <label class="govuk-label govuk-checkboxes__label" for="action-ahw5">
                  <strong>AHW5</strong> - Nesting plots for lapwing
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£765 per ha</span>
                </label>
              </li>

              <!-- GRH1 -->
              <li class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="action-grh1" name="actions" type="checkbox" value="GRH1">
                <label class="govuk-label govuk-checkboxes__label" for="action-grh1">
                  <strong>GRH1</strong> - Manage rough grazing for birds
                  <br>
                  <span class="govuk-body-s">Payment rate: Â£121 per ha</span>
                </label>
              </li> #}

            </div>
          </fieldset>
        </div>

      </div>

    </div>

    <!-- Application summary section -->
    <div class="govuk-grid-row ">
      <div class="govuk-grid-column-full">

       <!-- Continue button -->
        <button type="submit" class="govuk-button govuk-!-margin-top-6" data-module="govuk-button">
          Continue
        </button>

        <h2 class="govuk-heading-m">Your application so far</h2>
        <div class="govuk-!-margin-bottom-6">
          <p class="govuk-body">Selected actions and parcels</p>
          <ul class="govuk-list">
            <li>Action 1</li>
            <li>Action 2</li>
            <li>Selected parcels</li>
          </ul>
        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}

{% block pageScripts %}
<script>
  // Parcel data with different attributes and actions
  var parcelData = {
    'lower-field': {
      name: 'Lower Field',
      osRef: 'S03',
      numParcels: 20,
      totalArea: '120.3451',
      coords: {x: 230, y: 112, width: 120, height: 88},
      actions: ['CNUM3', 'CAHL1', 'CAHL2', 'CHRW2', 'CSAM2', 'BFS1', 'AHW7', 'CIPM2', 'WBD1', 'CNUM2']
    },
    'upper-field': {
      name: 'Upper Field',
      osRef: 'S01',
      numParcels: 15,
      totalArea: '5.2341',
      coords: {x: 50, y: 60, width: 130, height: 100},
      actions: ['CAHL1', 'CHRW2', 'SOH1', 'CIGL1', 'BND1', 'AHW3', 'CSAM3']
    },
    'woods-view': {
      name: 'Woods View',
      osRef: 'S02',
      numParcels: 8,
      totalArea: '12.8765',
      coords: {x: 360, y: 40, width: 120, height: 80},
      actions: ['CHRW2', 'WBD1', 'CHRW3', 'WBD3', 'GRH1', 'BND1']
    },
    'long-meadow': {
      name: 'Long Meadow',
      osRef: 'S04',
      numParcels: 12,
      totalArea: '8.4521',
      coords: {x: 30, y: 240, width: 170, height: 100},
      actions: ['CNUM2', 'CIGL1', 'CSAM3', 'GRH1', 'CAHL2', 'AHW5']
    },
    'river-pasture': {
      name: 'River Pasture',
      osRef: 'S05',
      numParcels: 18,
      totalArea: '15.3267',
      coords: {x: 250, y: 280, width: 170, height: 100},
      actions: ['BFS1', 'WBD1', 'WBD3', 'CIPM2', 'CNUM2', 'AHW7']
    },
    'top-barn-field': {
      name: 'Top Barn Field',
      osRef: 'S06',
      numParcels: 10,
      totalArea: '6.7894',
      coords: {x: 180, y: 150, width: 100, height: 80},
      actions: ['CNUM3', 'SOH1', 'PRF1', 'CSAM2', 'AHW3']
    },
    'lower-paddock': {
      name: 'Lower Paddock',
      osRef: 'S07',
      numParcels: 5,
      totalArea: '3.9152',
      coords: {x: 420, y: 200, width: 80, height: 70},
      actions: ['CIGL1', 'GRH1', 'CNUM2', 'CHRW2']
    },
    'oak-tree-field': {
      name: 'Oak Tree Field',
      osRef: 'S08',
      numParcels: 14,
      totalArea: '11.2483',
      coords: {x: 100, y: 180, width: 110, height: 90},
      actions: ['CAHL1', 'CAHL2', 'CIPM2', 'AHW7', 'CSAM3', 'CHRW3']
    },
    'south-slope': {
      name: 'South Slope',
      osRef: 'S09',
      numParcels: 11,
      totalArea: '9.6721',
      coords: {x: 300, y: 160, width: 100, height: 85},
      actions: ['SOH1', 'PRF1', 'BND1', 'CNUM3', 'AHW3']
    },
    'mill-field': {
      name: 'Mill Field',
      osRef: 'S10',
      numParcels: 9,
      totalArea: '7.1358',
      coords: {x: 150, y: 250, width: 95, height: 75},
      actions: ['CSAM2', 'CNUM2', 'CIGL1', 'WBD3', 'CAHL1']
    },
    'far-corner': {
      name: 'Far Corner',
      osRef: 'S11',
      numParcels: 6,
      totalArea: '4.5692',
      coords: {x: 400, y: 300, width: 85, height: 65},
      actions: ['GRH1', 'CHRW2', 'CIGL1', 'BND1']
    },
    'home-meadow': {
      name: 'Home Meadow',
      osRef: 'S12',
      numParcels: 16,
      totalArea: '13.8214',
      coords: {x: 120, y: 100, width: 115, height: 95},
      actions: ['CNUM3', 'CAHL1', 'CIPM2', 'AHW7', 'CSAM3', 'WBD1']
    },
    'church-field': {
      name: 'Church Field',
      osRef: 'S13',
      numParcels: 8,
      totalArea: '6.3547',
      coords: {x: 320, y: 220, width: 90, height: 70},
      actions: ['CHRW2', 'CHRW3', 'BND1', 'SOH1', 'CAHL2']
    },
    'brook-side': {
      name: 'Brook Side',
      osRef: 'S14',
      numParcels: 13,
      totalArea: '10.7265',
      coords: {x: 200, y: 320, width: 105, height: 80},
      actions: ['BFS1', 'WBD1', 'WBD3', 'CIPM2', 'CNUM2']
    },
    'hill-top': {
      name: 'Hill Top',
      osRef: 'S15',
      numParcels: 10,
      totalArea: '8.9431',
      coords: {x: 380, y: 120, width: 95, height: 75},
      actions: ['SOH1', 'PRF1', 'AHW3', 'BND1', 'GRH1']
    },
    'spring-field': {
      name: 'Spring Field',
      osRef: 'S16',
      numParcels: 7,
      totalArea: '5.6789',
      coords: {x: 260, y: 200, width: 88, height: 68},
      actions: ['CNUM2', 'CSAM2', 'CIGL1', 'CAHL1']
    },
    'gate-field': {
      name: 'Gate Field',
      osRef: 'S17',
      numParcels: 17,
      totalArea: '14.2156',
      coords: {x: 80, y: 280, width: 118, height: 92},
      actions: ['CNUM3', 'CAHL1', 'CAHL2', 'AHW7', 'CIPM2', 'CSAM3']
    },
    'stone-wall-pasture': {
      name: 'Stone Wall Pasture',
      osRef: 'S18',
      numParcels: 9,
      totalArea: '7.8923',
      coords: {x: 340, y: 260, width: 92, height: 72},
      actions: ['BND1', 'CHRW2', 'GRH1', 'CIGL1', 'SOH1']
    },
    'orchard-field': {
      name: 'Orchard Field',
      osRef: 'S19',
      numParcels: 4,
      totalArea: '3.4671',
      coords: {x: 440, y: 150, width: 75, height: 62},
      actions: ['CHRW3', 'CAHL1', 'CIPM2', 'WBD1']
    },
    'back-field': {
      name: 'Back Field',
      osRef: 'S20',
      numParcels: 14,
      totalArea: '11.5284',
      coords: {x: 160, y: 190, width: 108, height: 88},
      actions: ['CNUM3', 'CSAM2', 'AHW7', 'SOH1', 'PRF1', 'CAHL2']
    },
    'pond-field': {
      name: 'Pond Field',
      osRef: 'S21',
      numParcels: 11,
      totalArea: '9.1647',
      coords: {x: 280, y: 140, width: 98, height: 78},
      actions: ['WBD1', 'WBD3', 'BFS1', 'CIPM2', 'CNUM2']
    },
    'north-meadow': {
      name: 'North Meadow',
      osRef: 'S22',
      numParcels: 8,
      totalArea: '6.8935',
      coords: {x: 200, y: 80, width: 90, height: 72},
      actions: ['CIGL1', 'GRH1', 'CNUM2', 'CHRW2', 'CSAM3']
    },
    'willow-field': {
      name: 'Willow Field',
      osRef: 'S23',
      numParcels: 15,
      totalArea: '12.3458',
      coords: {x: 120, y: 220, width: 112, height: 86},
      actions: ['CHRW3', 'WBD1', 'CAHL1', 'CIPM2', 'AHW7']
    },
    'high-pasture': {
      name: 'High Pasture',
      osRef: 'S24',
      numParcels: 6,
      totalArea: '4.7821',
      coords: {x: 360, y: 340, width: 82, height: 64},
      actions: ['GRH1', 'CIGL1', 'BND1', 'CHRW2']
    },
    'lane-field': {
      name: 'Lane Field',
      osRef: 'S25',
      numParcels: 10,
      totalArea: '8.2594',
      coords: {x: 240, y: 260, width: 96, height: 76},
      actions: ['SOH1', 'PRF1', 'CSAM2', 'CNUM3', 'AHW3']
    },
    'big-meadow': {
      name: 'Big Meadow',
      osRef: 'S26',
      numParcels: 19,
      totalArea: '16.4372',
      coords: {x: 60, y: 140, width: 122, height: 98},
      actions: ['CNUM3', 'CAHL1', 'CAHL2', 'CIPM2', 'AHW7', 'CSAM3', 'CIGL1']
    },
    'little-field': {
      name: 'Little Field',
      osRef: 'S27',
      numParcels: 3,
      totalArea: '2.8156',
      coords: {x: 460, y: 240, width: 68, height: 58},
      actions: ['CHRW2', 'CIGL1', 'GRH1']
    },
    'bottom-field': {
      name: 'Bottom Field',
      osRef: 'S28',
      numParcels: 13,
      totalArea: '10.9283',
      coords: {x: 140, y: 300, width: 104, height: 82},
      actions: ['CNUM2', 'BFS1', 'WBD3', 'CIPM2', 'CSAM2']
    },
    'valley-field': {
      name: 'Valley Field',
      osRef: 'S29',
      numParcels: 9,
      totalArea: '7.5641',
      coords: {x: 300, y: 200, width: 94, height: 74},
      actions: ['SOH1', 'PRF1', 'AHW3', 'CAHL1', 'CSAM3']
    },
    'boundary-field': {
      name: 'Boundary Field',
      osRef: 'S30',
      numParcels: 7,
      totalArea: '5.1928',
      coords: {x: 380, y: 280, width: 86, height: 68},
      actions: ['BND1', 'CHRW2', 'CHRW3', 'GRH1']
    },
    'cottage-field': {
      name: 'Cottage Field',
      osRef: 'S31',
      numParcels: 16,
      totalArea: '13.6475',
      coords: {x: 180, y: 120, width: 116, height: 90},
      actions: ['CNUM3', 'CAHL1', 'AHW7', 'CIPM2', 'CSAM3', 'WBD1']
    }
  };

  // Action definitions with full details
  var actionDetails = {
    'CNUM3': { name: 'Legume fallow', rate: 'Â£593 per ha' },
    'CAHL1': { name: 'Pollen and nectar flower mix', rate: 'Â£739 per ha' },
    'CAHL2': { name: 'Winter bird food on arable and horticultural land', rate: 'Â£853 per ha' },
    'CHRW2': { name: 'Manage hedgerows', rate: 'Â£13 per 100m' },
    'CSAM2': { name: 'Multi-species winter cover crop', rate: 'Â£129 per ha' },
    'BFS1': { name: '12m to 24m watercourse buffer strip on cultivated land', rate: 'Â£707 per ha' },
    'AHW7': { name: 'Enhanced overwinter stubble', rate: 'Â£589 per ha' },
    'CIPM2': { name: 'Flower-rich grass margins, blocks or in-field strips', rate: 'Â£798 per ha' },
    'WBD1': { name: 'Manage ponds', rate: 'Â£257 per pond' },
    'CNUM2': { name: 'Legumes on improved grassland', rate: 'Â£102 per ha' },
    'SOH1': { name: 'No-till farming', rate: 'Â£73 per ha' },
    'CIGL1': { name: 'Take grassland field corners or blocks out of management', rate: 'Â£333 per ha' },
    'BND1': { name: 'Maintain dry stone walls', rate: 'Â£27 per 100m' },
    'AHW3': { name: 'Beetle banks', rate: 'Â£764 per ha' },
    'CSAM3': { name: 'Herbal leys', rate: 'Â£382 per ha' },
    'PRF1': { name: 'Variable rate application of nutrients', rate: 'Â£27 per ha' },
    'CHRW3': { name: 'Maintain or establish hedgerow trees', rate: 'Â£10 per 100m' },
    'WBD3': { name: 'In-field grass strips', rate: 'Â£765 per ha' },
    'AHW5': { name: 'Nesting plots for lapwing', rate: 'Â£765 per ha' },
    'GRH1': { name: 'Manage rough grazing for birds', rate: 'Â£121 per ha' }
  };

  // Function to select a parcel
  function selectParcel(parcelId) {
    var parcel = parcelData[parcelId];
    if (!parcel) return;

    // Update parcel information
    document.getElementById('parcel-name').textContent = parcel.name;
    document.getElementById('os-ref').textContent = parcel.osRef;
    document.getElementById('num-parcels').textContent = parcel.numParcels;
    document.getElementById('total-area').textContent = parcel.totalArea;
    document.getElementById('actions-heading').textContent = 'Available actions on ' + parcel.name;

    // Update map highlight position
    var innerRect = document.getElementById('highlight-inner');
    var outerRect = document.getElementById('highlight-outer');
    
    innerRect.setAttribute('x', parcel.coords.x);
    innerRect.setAttribute('y', parcel.coords.y);
    innerRect.setAttribute('width', parcel.coords.width);
    innerRect.setAttribute('height', parcel.coords.height);
    
    outerRect.setAttribute('x', parcel.coords.x - 3);
    outerRect.setAttribute('y', parcel.coords.y - 3);
    outerRect.setAttribute('width', parcel.coords.width + 6);
    outerRect.setAttribute('height', parcel.coords.height + 6);

    // Update actions list - show only actions available for this parcel
    updateActionsList(parcel.actions);

    // Scroll to top to see the changes
    window.scrollTo({top: 0, behavior: 'smooth'});
  }

  // Function to update the actions list based on available actions
  function updateActionsList(availableActions) {
    var checkboxItems = document.querySelectorAll('.govuk-checkboxes__item');
    
    checkboxItems.forEach(function(item) {
      var checkbox = item.querySelector('input[type="checkbox"]');
      var actionCode = checkbox.value;
      
      // Show or hide based on availability for this parcel
      if (availableActions.indexOf(actionCode) > -1) {
        item.style.display = '';
      } else {
        item.style.display = 'none';
      }
      
      // Uncheck all checkboxes when switching parcels
      checkbox.checked = false;
    });
  }

  // Search functionality for actions on map page
  $(document).ready(function(){
    $("#search-actions-map").keyup(function(){ 
        var filter = $(this).val();
        $(".govuk-form-group li").each(function(){
            if ($(this).text().search(new RegExp(filter, "i")) < 0) {
                $(this).fadeOut();
            } else {
                // Only show if it's currently visible (not filtered by parcel selection)
                if ($(this).css('display') !== 'none') {
                  $(this).show();
                }
            }
        });
    });

    // Initialize with Lower Field selected
    selectParcel('lower-field');
  });
</script>
{% endblock %}


